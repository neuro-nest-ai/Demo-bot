import mysql.connector
from flask import Flask, request


class WhatsAppChatbot:
    def __init__(self, database_config):
        self.db_config = database_config

    def search_user_by_phone(self, phone_number):
        conn = mysql.connector.connect(**self.db_config)
        cursor = conn.cursor()
        cursor.execute('SELECT * FROM users WHERE phone_number = %s', (phone_number,))
        user = cursor.fetchone()
        conn.close()
        return user

    def add_user(self, phone_number, name):
        conn = mysql.connector.connect(**self.db_config)
        cursor = conn.cursor()
        cursor.execute('INSERT INTO users (phone_number, name) VALUES (%s, %s)', (phone_number, name))
        conn.commit()
        conn.close()

    def process_whatsapp_message(self,phone_number):
        user_details = self.search_user_by_phone(phone_number)

        if user_details:
            user_name = user_details[2]# Assuming 'name' is in the third column
            if user_name=="Ganesan":
                greeting_message="Hi President How are u? How may I help you?"
                return greeting_message
            elif user_name=="Diwakar":
                greeting_message="Hey sec How are you treasurer ? How may i help you?"
                return greeting_message
            elif user_name=='Prabu':
                greeting_message="Hey secretary how are you? How may i help u?"
                return greeting_message
            else:
                greeting_message = f"Hey {user_name}, how are you? How may I help you?"
                return greeting_message
        else:
            user_name = input("Enter the full_name")
            if user_name=="Ganesan":
                greeting_message=f"Welcome, {user_name}! You are President of Rotary_club,How may help u?"
                self.add_user(phone_number, user_name)
                return greeting_message
            elif user_name=="Diwakar":
                greeting_message=f"Welcome, {user_name}! You are Treasurer of Rotary_club,How may help u?"
                self.add_user(phone_number, user_name)
                return greeting_message
            elif user_name=="Prabu":
                greeting_message= f"Welcome, {user_name}! You are Secretary of Rotary_club,How may help u?"
                self.add_user(phone_number, user_name)
                return greeting_message

    
    


































































































































































































































































































































































































































































































































































































































































































































































































































































































































   
   

   
   
   

   
   
   
   
   
   
   
   



















































